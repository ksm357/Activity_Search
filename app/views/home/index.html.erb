<!--<h1 align="center">엑서(Activity Search)</h1>-->

<!-- 네비바 -->
    <%= render 'home/header' %>

<!-- 관리자 페이지로 이동 -->
<hr>
<a href="/admin/new_create">데이터 추가하기 - admin만 접근 가능</a>

<!-- 영상 제작 -->
<header>
    <hr>
    로그인을 하면 더 많은 서비스를 이용할 수 있습니다. 
    <h3>마!! 운동 자신있나!! 난 있는데!? </h3>
</header>

<div class="container">
    <!-- 지도 섹션-->
    <section id="activity">
        <hr>
        <form action="/find" method="get">
        <%#= form_tag('/find', method: 'post') do %>
        
            종목 : 
            <select name="game">
                <option>볼링</option>
                <option>탁구</option>
                <option>골프</option>
                <option>야구</option>
                <option>요가</option>
            </select>
            <%#= select_tag(:game, options_for_select([
            ['볼링', nil], ['탁구', nil], ['골프', nil], ['야구', nil], ['요가', nil]
            ])) %>
            
            지역 :
            <select name="region">
                <option>강남구</option>
                <option>강동구</option>
                <option>강북구</option>
                <option>강서구</option>
                <option>관악구</option>
                <option>광진구</option>
                <option>구로구</option>
                <option>금천구</option>
                <option>노원구</option>
                <option>도봉구</option>
                <option>동대문구</option>
                <option>동작구</option>
                <option>마포구</option>
                <option>서대문구</option>
                <option>서초구</option>
                <option>성동구</option>
                <option>성북구</option>
                <option>송파구</option>
                <option>양천구</option>
                <option>영등포구</option>
                <option>용산구</option>
                <option>은평구</option>
                <option>종로구</option>
                <option>중구</option>
                <option>중랑구</option>
            </select>
            <%#= select_tag(:region, options_for_select([
            ['강남구', nil], ['강동구', nil], ['강북구', nil], ['강서구', nil], ['관악구', nil],
            ['광진구', nil], ['구로구', nil], ['금천구', nil], ['노원구', nil], ['도봉구', nil],
            ['동대문구', nil], ['동작구', nil], ['마포구', nil], ['서대문구', nil], ['서초구', nil],
            ['성동구', nil], ['성북구', nil], ['송파구', nil], ['양천구', nil], ['영등포구', nil],
            ['용산구', nil], ['은평구', nil], ['종로구', nil], ['중구', nil], ['중랑구', nil]
            ])) %>
            <input type="submit" value="찾기"/>
            <%#= submit_tag('찾기') %>
        </form>
        <%# end %>
        
        <div class="search">
                <input id="address" type="text" placeholder="검색할 주소">
                <input id="submit" type="button" value="주소 검색">
        </div>
        
        <div id="map"></div>
    </section>
    
    <!-- 이벤트 섹션-->
    <section id="event">
        <hr>
        여러가지 이벤트
    </section>
    
    <!-- 소모임(고객참여게시판) 섹션-->
    <section id="client">
        <hr>
        고객이 직접 Activity를 추가할 수 있습니다.<br>
        <a href="#">추가하러가기</a>
    </section>
    
    <!-- 캐스트 섹션 -->
    <section id="cast">
        <hr>
        cast정보 <br>
        <%= link_to '캐스트 더 보기', '/casts' %>
    </section>
</div>

<!-- likelion -->
<footer>
    <hr>
    Copyright &copy; Likelion 2017
</footer>

<script type="text/javascript">
    // var HOME_PATH = window.HOME_PATH || '.';

    var seoulCenter = new naver.maps.LatLng(37.5665350, 126.9779690); //서울 시청 좌표값(서울 한가운데)
    
// 지도 기본 위치
    var map = new naver.maps.Map('map', {
        center: seoulCenter,
        zoom: 6,
        scaleControl: false,
        logoControl: false,
        mapDataControl: false,
        mapTypeControl: true,
        zoomControl: true,
        minZoom: 1,
        zoomControlOptions: {
            position: naver.maps.Position.TOP_RIGHT
        }
    });
    
    // GPS
    // var locationBtnHtml = '<a href="#" class="btn_mylct"><span class="spr_trff spr_ico_mylct">NAVER 그린팩토리</span></a>';
    // GPS 이미지 파일 넣는 곳
    var locationBtnHtml = '<img src="https://pbs.twimg.com/profile_images/565254803643592704/KaVxRt4p.png" style="width: 50px" onclick="getLocation()">';
    var customControl = new naver.maps.CustomControl(locationBtnHtml, {
        position: naver.maps.Position.TOP_LEFT
    });
    customControl.setMap(map);
    
//마커
    var games = new Array();
    var marker = new Array();
    var contentString;
    
    <% @storeInfo.each do |i| %>
        games[<%= i.id %>] = new naver.maps.LatLng(<%= i.location_lat %>, <%= i.location_lng %>);
        
        var markerOptions = {
            position: games[<%= i.id %>],
            map: map,
            icon: {
                url: '<%= image_tag("bowling.png") %>', //마커 url, 마커 이미지 url
                size: new naver.maps.Size(33, 44), // 마커 사이즈
                origin: new naver.maps.Point(0, 0), // origin 기본값 (0, 0)
                anchor: new naver.maps.Point(11, 35) // anchor속성은 이미지의 중앙 하단 포인터를 기본값으로 설정
            },       
            zIndex: 100
        };
        
        marker[<%= i.id %>] = new naver.maps.Marker(markerOptions);
        
        // 마커 안에 정보 넣기 
        // db에 있는 정보 불러내기 아직 구현 못함
        contentString= [
            '<div class="iw_inner">',
            '   <h4><%#= i.name %></h4>',
            '   <p><%#= i.region %> | <%#= i.address %><br />',
            '       <img src= "" width="20" height="20" alt="서울시청" class="thumb" /><br />',
            '       02-120 | <%#= i.game %> &gt; 특별,광역시청<br />',
            '       <a href="http://www.seoul.go.kr" target="_blank">www.seoul.go.kr/</a>',
            '   </p>',
            '</div>'
        ].join('');
    
        var infowindow = new naver.maps.InfoWindow({
            content: contentString
        });
    
        naver.maps.Event.addListener(marker[<%= i.id %>], "click", function(e) {
            if (infowindow.getMap()) {
                infowindow.close();
            } else {
                infowindow.open(map, marker[<%= i.id %>]);
            }
        });
    <% end %>

// GPS이용하기

    // HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
    function getLocation() {
        if (navigator.geolocation) {
            
            // GeoLocation을 이용해서 접속 위치를 얻어옵니다
            navigator.geolocation.getCurrentPosition(function(position) {
                
                var lat = position.coords.latitude, // 위도
                    lon = position.coords.longitude; // 경도
                
                var locPosition = new naver.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
                    message = '<div style="padding:5px;">여기에 계신가요?!</div>'; // 인포윈도우에 표시될 내용입니다
                
                // 마커와 인포윈도우를 표시합니다
                displayMarker(locPosition, message);
              });
        } else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
        
            var locPosition = new naver.maps.LatLng(37.56653501, 126.9779690),    
                message = 'geolocation을 사용할수 없어요'
                
            displayMarker(locPosition, message);
        }
    }
    // 지도에 마커와 인포윈도우를 표시하는 함수입니다
    function displayMarker(locPosition, message) {

        // 마커를 생성합니다
        var gpsMarker = new naver.maps.Marker({  
            map: map, 
            position: locPosition,
            icon: {
                url: 'https://pbs.twimg.com/profile_images/565254803643592704/KaVxRt4p.png',
                size: new naver.maps.Size(25, 34),
                scaledSize: new naver.maps.Size(25, 34),
                origin: new naver.maps.Point(0, 0),
                anchor: new naver.maps.Point(12, 34)
            }
        }); 
        
        var iwContent = message, // 인포윈도우에 표시할 내용
            iwRemoveable = true;
            
        // 인포윈도우를 생성합니다
        var geoinfowindow = new naver.maps.InfoWindow({
            content : iwContent,
            removable : iwRemoveable
        });
        
        // 인포윈도우를 마커위에 표시합니다 
        geoinfowindow.open(map, gpsMarker);
        
        // 지도 중심좌표를 접속위치로 변경합니다
        map.setCenter(locPosition);      
    }    
    //---------------------------------------------------------//
</script>